掲示板を作る
============

[前のステップ](../3_login/)では、セッションを用いた短期間の、小さなデータの保存しか出来ませんでした。
このステップでは、より多くのデータを扱ったり、データを長い期間保存するための方法を学びます。

このステップは、[次のステップ](../4_disscussion-board/)で掲示板を作るための前準備になります。

## 何が必要か
データを保存するためには、簡単には二つの方法があります。

一つは、みなさんが普段使っているような普通のファイルを使う方法です。
普通のファイルなので簡単ではありますが、扱うデータが沢山になったり、複雑な処理を行なおうとすると途端に難しくなってしまいます。

そんな難しい処理を簡単にするために、データベースを使うという二つめの方法があります。
データベースを扱うためには覚えなければいけないことがいくつかありますが、データが増えても処理が複雑になっても同じ方法で扱えるというメリットがあります。

ここで作る掲示板程度の物であれば普通のファイルでも問題無いのですが、きちんと作り込むためにはデータベースの知識が不可欠になります。
ですので、今回は[*sqlite*](https://www.sqlite.org/)というデータベースを使用することにします。（普通のファイルを扱う方法については[Step 7](./7_profile-page/)で説明します。）

*sqlite*以外にも色々な種類のデータベースがあるのですが、なんとPythonには標準で[sqliteのライブラリ](https://docs.python.jp/3/library/sqlite3.html)があるのです。
他にも、作ったデータベースを普通のファイルとして扱うことが出来たり、データベースサーバーを立ち上げる必要なく利用出来たりと、sqliteはとても簡単に使うことが出来るデータベースです。

## sqliteを試してみる
Pythonに付属しているsqliteを使用するには、まず最初にライブラリのインポートを行なう必要があります。（*インポート*という言葉については[Step 1](../1_hello-world/#import-flask)に説明があります。）
sqliteのインポートは以下のようにして行ないます。これを、これから作成するプログラムの一番最初に書いてください。
``` python
import sqlite3
```

次に、データベースの作成を行ないます。sqliteでは、データベースは全て一つのファイルに保存します。なので、データベースを開くにはファイル名を指定します。
``` python
db = sqlite3.connect('database.db')
```

次に、テーブルの作成を行ないます。
``` python
db.execute('CREATE TABLE tbl (id, text)')
```
`'`で囲った中身は、データベースを操作するための言語で、SQL文というものです。
このSQL文は、「`id`と`text`という二つのパラメータを持った情報を保存するための`tbl`というテーブルを作成する」という意味を持っています。

SQLというのはとても奥が深いものなので、この講座では細かい話はしないでおくことにします。
この講座で使用しているSQL文は可能な限り簡略化したものですので、効率的とは言い難いものも含まれています。実用的なものに流用するときは、注意して使用してください。

テーブルが出来たら、今度はデータを保存してみます。
``` python
db.execute('INSERT INTO tbl VALUES (?, ?)', (0, 'hello'))
```
今度のSQL文は「`id`が`0`で、`text`が`'hello'`というデータを`tbl`というテーブルに保存する」という意味です。

最後に、保存したデータを取得してみます。
``` python
result = db.execute('SELECT * FROM tbl')
data = result.fetchall()
print(data)
```
一行目に記述したSQL文は「`tbl`というテーブルから全てのデータを取得する」という意味です。今までと違い、結果を`result`という変数に保存していることに注意してください。

二行目で、結果からデータを取得しています。
